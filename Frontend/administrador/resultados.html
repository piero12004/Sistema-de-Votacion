<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados - Panel Administrativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-bg': '#f3f4f6', 
                        'sidebar-bg': '#3c676e', 
                        'main-title': '#2e4963', 
                        'sidebar-btn-active': '#e5e7eb', 
                        'custom-dark-button': '#355b63', 
                        'vote-color-1': '#dc2626', 
                        'vote-color-2': '#4f6a73', 
                        'vote-color-3': '#6b21a8', 
                    },
                    spacing: {
                        'sidebar-width': '16rem', 
                    }
                }
            }
        }

        const procesos = [
            'Elecciones Estudiantes', 
            'Elección Decano', 
            'Comité de Ética', 
            'Delegados de Facultad'
        ];

        const resultadosSimulados = {
            'Elecciones Estudiantes': {
                ganador: { name: 'Candidato A', votes: 450, img: 'https://placehold.co/150x150/d8e2ee/355b63?text=A' },
                votos: [
                    { candidate: 'Candidato A', percentage: 45, color: 'vote-color-1' },
                    { candidate: 'Candidato B', percentage: 30, color: 'vote-color-2' },
                    { candidate: 'Candidato C', percentage: 25, color: 'vote-color-3' },
                ]
            },
            'Elección Decano': {
                ganador: { name: 'Candidato D', votes: 600, img: 'https://placehold.co/150x150/d8e2ee/355b63?text=D' },
                votos: [
                    { candidate: 'Candidato D', percentage: 60, color: 'vote-color-1' },
                    { candidate: 'Candidato E', percentage: 40, color: 'vote-color-2' },
                ]
            },
            'Comité de Ética': {
                ganador: { name: 'Candidato B', votes: 600, img: 'https://placehold.co/150x150/d8e2ee/355b63?text=B' },
                votos: [
                    { candidate: 'Candidato B', percentage: 60, color: 'vote-color-1' },
                    { candidate: 'Candidato E', percentage: 40, color: 'vote-color-2' },
                ]
            },
            'Delegados de Facultad': {
                ganador: { name: 'Candidato C', votes: 600, img: 'https://placehold.co/150x150/d8e2ee/355b63?text=C' },
                votos: [
                    { candidate: 'Candidato C', percentage: 60, color: 'vote-color-1' },
                    { candidate: 'Candidato E', percentage: 40, color: 'vote-color-2' },
                ]
            }
        };

        let selectedProcess = procesos[0]; 
        function drawPieChart(data) {
            const canvas = document.getElementById('vote-chart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const total = 100; 
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.8;
            let currentAngle = 0;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const tailwindConfig = tailwind.config.theme.extend.colors;

            data.forEach(slice => {
                const sliceAngle = (slice.percentage / total) * (Math.PI * 2);
                
                const colorKey = slice.color;
                const fillColor = tailwindConfig[colorKey] || '#cccccc';

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();

                ctx.fillStyle = fillColor;
                ctx.fill();

                currentAngle += sliceAngle;
            });
        }

        function updateResults(processName) {
            selectedProcess = processName;
            document.getElementById('current-process-name').textContent = processName;
            
            const result = resultadosSimulados[processName] || { ganador: { name: 'N/A', img: 'https://placehold.co/150x150/f0f0f0/333333?text=N/A' }, votos: [] };

            drawPieChart(result.votos);

            const legendContainer = document.getElementById('chart-legend');
            let legendHtml = '';
            result.votos.forEach(voto => {
                const colorKey = voto.color;
                const color = tailwind.config.theme.extend.colors[colorKey] || '#cccccc';
                legendHtml += `
                    <div class="flex items-center space-x-2 text-sm text-gray-700">
                        <span class="w-3 h-3 rounded-full" style="background-color: ${color};"></span>
                        <span class="font-medium">${voto.candidate}:</span>
                        <span>${voto.percentage}% de los votos</span>
                    </div>
                `;
            });
            legendContainer.innerHTML = legendHtml;

            document.getElementById('winner-name').textContent = result.ganador.name;
            document.getElementById('winner-img').src = result.ganador.img;

            updateFilterDisplay();
        }

        function toggleFilterList() {
            const list = document.getElementById('filter-process-list');
            list.classList.toggle('hidden');
        }

        function renderFilterList() {
            const list = document.getElementById('filter-process-list');
            let html = procesos.map(process => `
                <a href="#" onclick="selectProcess('${process}'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-100">${process}</a>
            `).join('');
            list.innerHTML = html;
        }


        function selectProcess(processName) {
            updateResults(processName);
            toggleFilterList(); 
        }

        function updateFilterDisplay() {
            const input = document.getElementById('filter-input');
            input.value = selectedProcess;
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderFilterList();
            updateResults(procesos[0]); 
        });
    </script>
</head>
<body class="bg-main-bg font-sans">

    <div class="flex min-h-screen">
        
        <div class="w-sidebar-width bg-sidebar-bg text-white flex flex-col justify-between p-4 fixed h-full shadow-lg">
            <div>
                <div class="flex items-center space-x-3 mb-8 border-b border-gray-500 pb-4">
                    <div class="p-2 rounded-full bg-white text-sidebar-bg">
                        <i class="fas fa-user text-xl"></i>
                    </div>
                    <span  id="nombreAdmin" class="text-xl font-semibold">Usuario</span>
                </div>

                <nav class="space-y-3">
                    <a href="principal.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition duration-150 text-white">
                        <i class="fas fa-home w-5 h-5"></i>
                        <span>Panel principal</span>
                    </a>
                    
                    <a href="procesos-electorales.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition duration-150 text-white">
                        <i class="fas fa-clipboard-list w-5 h-5"></i>
                        <span>Procesos electorales</span>
                    </a>
                    
                    <a href="candidatos.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition duration-150 text-white">
                        <i class="fas fa-users w-5 h-5"></i>
                        <span>Candidatos</span>
                    </a>
                    
                    <a href="fechas-y-periodos.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-700 transition duration-150 text-white">
                        <i class="fas fa-calendar-alt w-5 h-5"></i>
                        <span>Fechas y Periodos</span>
                    </a>
                    
                    <a href="#" class="flex items-center space-x-3 p-3 rounded-lg bg-sidebar-btn-active text-gray-800 font-medium shadow-md">
                        <i class="fas fa-chart-bar w-5 h-5 text-custom-dark-button"></i>
                        <span>Resultados</span>
                    </a>
                </nav>
            </div>

            <div class="mt-8">
                <a href="#" id="btnCerrarSesion"
                    class="w-full py-3 bg-blue-400 text-white font-semibold rounded-lg hover:bg-blue-500 transition duration-150 shadow-md flex justify-center">
                        Cerrar Sesión
                </a>
            </div>
        </div>
        
        <main class="flex-1 p-8 md:p-12 ml-sidebar-width">
            
            <h1 class="text-4xl font-serif text-main-title mb-10 border-b pb-4 text-center md:text-left">
                Resultados de las votaciones
            </h1>
            
            <div class="flex flex-col md:flex-row gap-10">
                
                <div class="w-full md:w-1/3 space-y-8">
                    
                    <div class="relative w-full max-w-sm">
                        <div class="relative">
                            <input type="text" id="filter-input" placeholder="Filtrar por Proceso" 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-custom-dark-button focus:border-custom-dark-button transition duration-150 cursor-pointer"
                                readonly onclick="toggleFilterList()">
                            
                            <button type="button" onclick="document.getElementById('filter-input').value = ''" class="absolute inset-y-0 right-10 flex items-center pr-3 text-gray-500 hover:text-gray-800">
                                <i class="fas fa-times"></i>
                            </button>
                            <i class="fas fa-caret-down absolute inset-y-0 right-3 flex items-center text-gray-500"></i>
                        </div>

                        <div id="filter-process-list" class="absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-xl hidden">
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-custom-dark-button">
                        <h3 class="text-xl font-semibold text-custom-dark-button mb-4 border-b pb-2">
                            Distribución de Votos (<span id="current-process-name"></span>)
                        </h3>
                        
                        <div class="flex flex-col md:flex-row items-center justify-around gap-6">
                            <div class="w-40 h-40 flex-shrink-0">
                                <canvas id="vote-chart" width="160" height="160" class="mx-auto"></canvas>
                            </div>
                            <div id="chart-legend" class="space-y-2 text-left">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-full md:w-2/3">
                    <div class="bg-white p-8 rounded-xl shadow-lg h-full flex flex-col items-center justify-center">
                        
                        <h2 class="text-3xl font-serif text-main-title mb-8">
                            Candidato Ganador
                        </h2>

                        <div class="w-48 h-48 bg-gray-200 rounded-full flex items-center justify-center mb-6 overflow-hidden shadow-xl border-4 border-yellow-400">
                            <img id="winner-img" src="" alt="Avatar del Ganador" class="w-full h-full object-cover rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/150x150/d8e2ee/355b63?text=Ganador';" />
                        </div>
                        
                        <h3 id="winner-name" class="text-3xl font-bold text-custom-dark-button">Candidato [Nombre]</h3>
                        <p class="text-lg text-gray-500 mt-1 italic">¡Felicidades!</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { cargarNombreAdmin, protegerPagina, cerrarSesion } from "./js/admin.js";

        // Protege la página al cargar
        protegerPagina();

        // Muestra el nombre del admin
        cargarNombreAdmin();

        // Si tienes un botón de cerrar sesión
        document.getElementById("btnCerrarSesion")?.addEventListener("click", cerrarSesion);
    </script>
</body>
</html>